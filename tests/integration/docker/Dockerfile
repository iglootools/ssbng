FROM debian:latest

RUN apt-get update && \
    apt-get install -y --no-install-recommends \
    openssh-server \
    rsync \
    btrfs-progs \
    libcap2-bin \
    && setcap cap_sys_admin+ep "$(command -v btrfs)" \
    && rm -rf /var/lib/apt/lists/*

RUN useradd -m -s /bin/bash testuser && \
    mkdir -p /home/testuser/.ssh && \
    chmod 700 /home/testuser/.ssh && \
    chown testuser:testuser /home/testuser/.ssh

RUN mkdir -p /run/sshd

COPY entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

EXPOSE 22

ENTRYPOINT ["/entrypoint.sh"]
